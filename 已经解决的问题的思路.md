
# 10000 行   

写程序也是要这样。为客户着想，最大程度地减轻负担。不是以工作时长为目标，而是以减轻负担，而是以自己发挥的作用为目标。     
作为一个医生，要一切为病人着想，把病人当做你的亲人一样。所以你要用最便宜，最简单的，而且最有效的，技术，手段，来为病人解决问题，治好病。就是为病人着想，给病人最大地减轻负担。   

要了解内部原理，（要有扎实的编程基础，要了解程序的代码）。    
制作模型，对血管和结构了如指掌。了解了肝脏解剖学后，破解了肝脏手术的密码。    

要做充分的测试。只有充分的测试，才能对代码有 control。   
怎么敢签字，怎么敢说没问题？就是所有能想到的测试，全部都做过了。   

*** 

# 专家观点库 zjgdk_title 缓存 06.15  

1. 通读 redis sorted set 文档。已完成。
2. 看 python redis 包的 sorted set。已完成。       
3. 看 cyberin 的 zadd 代码。已完成。  
4. 判断元素在缓存里。zrank。已完成。       
5. 判断时间差。已完成。    
6. 删除元素。已完成。  
7. 解决跑数据命令的 bug。已完成。   


# 长城日报更新 is_clean 字段脚本 06.14     

1. 统计一天中 is_clean 为 0 的数量。    
2. 修改脚本，有一次成功就是成功。  
3. 修改视图函数，是 None 的才更新。   


# 日报导出改为通过域名判断 06.13  

1. 参考跑数据代码，修改导数据逻辑。已完成。  
2. 先写日报 3。已完成。
3. 通过 url 上传 debug 代码，确定在哪里打印的 rd 结果，查找重新去爬数据的原因。没有 author_id。已完成。     
4. 添加更新 author_id 的代码。已完成。    
5. 修改 url 导出代码。已完成。
6. 看爬的数据，没有爬到的原因。已完成。   


# 改话题增量 06.08  

1. 改 model，添加两个字段。已完成。   
2. 数据库添加两个字段。已完成。    
3. 更新原来的数据。已完成。   
4. 新添加的数据要计算增量。已完成。


# 导数据，车友圈不过噪音判断 06.07  

1. 整体取消噪音。已完成。  
2. 在查出结果遍历的时候，如果是那一个网站，就是所有。已完成。  
3. 如果不是那个网站，就要过滤噪音。已完成。    
4. 要考虑 spider_url。已完成。  


# 长城项目短视频导出基本功能 05.13   

1. 创建项目。已完成。   
2. 创建 Git repo。已完成。
3. 同步代码。已完成。
4. 读取数据。已完成。
5. 遍历数据。已完成。  
6. 判断品牌，放入不同的列表中。已完成。  
7. 用户分组。已完成。
8. 拼接吐槽内容。已完成。    
1. 先实现保存功能。已完成。
2. 先保存一个。已完成。
3. 传 brand_name。已完成。
4. 自动调用，自动保存。已完成。
5. 解决保存以后不带最后的 string 的问题。.upper() 没加括号。已完成。    
6. 复制已有的 HTML 代码。已完成。
7. 复制视图函数。已完成。
8. 通读第一遍，删除肯定不会用到的内容。已完成。
9. 通读第二版，弄明白大概的功能。已完成。
10. 自己写代码。已完成。
11. 先实现上传功能。已完成。
12. 创建文件夹。已完成。   
13. 取 bootstrap 上找一个上传文件的框。先用一个简单的先完成功能再说。已完成。   
14. 实现下载功能。已完成。  
15. 先下载一个固定的文件。已完成。
16. 解决下载的文件没有文件名问题。用 quote 方法。已完成。
17. 修改核心处理函数，传入一个 Excel，生成两个 word 文件。替换 f 字符串。已完成。  
18. 替换路径。已完成。
19. 解决 python 无法运行的问题。解决 Interpreter 配置问题，解决 settings 配置问题。已完成。
20. 解决兼容问题。已完成。  
21. 添加测试。已完成。  


# 秒针打标签测试 05.09  

总体来说是 4 步：
1. 读 sample 的 Sheet1 拿到绿色的列名；
2. 在标签树表中拿到对应的二级标签和三级标签和对应的关键词；
3. 在样本数据表里对数据进行匹配打标签；
4. 评价结果。   
1. 读 sample 的 Sheet1 表。取绿色列名。已完成。
2. 获取原三级标题。已完成。   
3. 获取拆解列。已完成。  
4. 解决拆分成两列的问题。已完成。  
5. 读取样本数据。已完成。
6. 读取样本数据里的多列。已完成。
7. 读取样本数据里的一列。已完成。   
8. 先实现只取绿色的。三级标签。已完成。   
9. 取出来的存 Excel。已完成。   
10. 读取 tag，转成字典格式。已完成。  
11. 取到值的字符串。list 转换。已完成。   
12. 解决任意一个为空的时候的 in 判断问题。fillna(value='')。已完成。
13. 解决报错。value 有 int，转成 str。已完成。   
14. 遍历判断，打标签。已完成。
15. 报存 Excel。已完成。   
16. 评价结果。已完成。
17. 解决保存结果和原数据一样的问题。已完成。
18. 解决列不一样多的问题。原始标签里多一个资生堂。手动删除。已完成。   
19. 打印 precision、recall 和 f1 值。已完成。   
20. 读文档，弄明白 support 是什么意思。有多少个 1。已完成。
21. 弄懂混淆矩阵的位置和意义。TN、FN、TP、FP。已完成。      
22. 测试用 len 循环保存。已完成。
23. 去除 nan 以后再评估结果。已完成。  
24. 先对数据做处理，处理完以后保存。已完成。  
25. 看文档 dropna。已完成。   
26. 解决 y_true 中包含文字的问题。存的时候忘了添加 index=False 参数，多了一列 index。已完成。
27. 看数据，先看 FP。y_true=0, y_pred=1 已完成。   
28. 解决匹配遗漏问题。遍历 tag 的时候，后面的结果覆盖了前面的结果。已完成。   
29. 解决读取数据错误问题。应该读 green_data_remove_nan.xlsx 结果读的还是 greed_data.xlsx 文件。已完成。
30. 继续看 FN 高的问题。有 5 列没有关键词，drop 这 5 列。已完成。
31. 添加 preprocess.py。已完成。  


# 状态更新转移到视频表中 05.05  

1. 修改现在视图函数的错误。any 的用法不对啊，any 里面要放可迭代元素，存列表。已完成。
2. 先弄清楚逻辑。
3. 看现在的更新逻辑。内容非空，而且所有的都已修才是已修。已完成。
4. 在视频表中添加 ocr、logo 和品种状态。已完成。  
5. 修改数据库。参考详情表。已完成。  
6. 修改 models.py。已完成。   
7. 确定内容非空的代码写在什么位置。写在详情里面。已完成。
8. 修改 views.py。直接在列表表中查询。已完成。
9. 修改 views.py。详情保存。已完成。   
10. 先做 logo 和 breed。已完成。 
11. 再做 ocr。已完成。   


# 修改保存功能 05.04  

1. 解决一次点击会多次调用监听事件问题。触发之前要先用 .off() 解绑监听事件，否则会累加。已完成。  
2. 测试 .one() 方法是否能达到同样的效果。不行，因为要每次判断 input 文本是否为空。已完成。  
3. 验证其他事件是否有多次执行的问题。所有通过 .on() 绑定的事件都有多次执行的问题。已完成。
4. 上面所有的事件都通过 .off() 解除绑定。已完成。   
5. 测试。改出了一些问题。已完成。
6. 解决删除按钮和上移按钮失效问题。已完成。   
7. 看 jQuery 官方文档查 .off() 的用法。要在 .off() 事件后面添加选择器，否则会互相干扰。已完成。  
8. 测试。已完成。  
9. 监听所有 input 框的 change 事件，当框内内容发生改变，且区域内文字不为空，则保存按钮颜色从灰色变为蓝色、移除按钮不可点击属性。      
10. 监听 change 事件。$(document).off("input", ".multi-line-input").on("input", ".multi-line-input", function () {}。已完成。  
11. 判断整个区域内所有 input 文字是否为空。this_line_input.parent().parent().find("p").text().trim() !== ""。已完成。
12. 如果内容改变，且非空，则按钮改变颜色。已完成。
13. 查看蓝色颜色编码。#3399ff。已完成。
14. 获取 button。this_line_input.parent().parent().siblings(".detail-right-button-area").find(".right-second-button")。已完成。  
15. 替换颜色。save_button.css("background-color", "#3399ff")。已完成。
16. 移除 disabled 属性。.removeAttr("disabled")。已完成。  
17. 如果为空，则需要修改颜色为灰色，并且添加 disabled 属性。save_button.css("background-color", "##999999").attr("disabled", "disabled")。已完成。
18. 测试。测试失败，为空的时候没有置灰。已完成。   
19. 浏览器 js 脚本没有更新。强刷。已完成。  
20. 测试。测试失败。已完成。  
21. 测试有没有进入分支语句。进入了分支语句。已完成。  
22. 确认选择器有没有获取到。获取到了。已完成。  
23. 检查为什么颜色没有改变。颜色编码中多写了一个 #。已完成。  
24. 测试。已完成。     
1. 测试有 disabled 属性的保存按钮，是否可以拿到点击事件。拿不到。已完成。
2. 获取保存按钮的点击事件。已完成。
3. 写后台接口。基本逻辑是：内容发生改变且文字非空则可以保存；保存数据库只修改这一张图片；图片状态改为已修；视频状态改为已修；只修改这一个类别，是 logo 就只修改 logo，是 ocr 就只修改 ocr；遍历前端所有的行；只有非空的行才会存；取文字和坐标；ocr 文字还要根据字幕花字进行处理。
4. 写 url。/detail_save。已完成。
5. 创建视图函数。已完成。
6. 写 Ajax 请求。已完成。
7. 解决报错。Ajax 语法错误。已完成。  
8. 解决端口占用，无法启动服务问题。已完成。  
9. 判断要传入的参数。图片 id、类别、如果是 ocr 还要传是字幕还是花字、文字内容、坐标、格式为数组套字典。
10. 获取 plus icon 的 id 属性。$(this).siblings("img").attr("id")。已完成。
11. 获取图片 id。从 plus icon 中获取。plus_icon_id.split("-")。已完成。
12. 查询 JavaScript 怎么获取数组最后一个元素。len-1；.pop()；slice(-1)。已完成。
13. 获取修改的类别。plus_icon_id_arr.slice(0)。已完成。
14. 测试结果。结果不正确。已完成。  
15. 读文档，查 slice() 的用法。如果只写一个数字，表示获取从这个数字开始到后面所有的元素的数组。已完成。
16. 改用索引获取元素。已完成。
17. 测试。测试 ocr、logo、breed。已完成。
18. 获取所有的 input。$(this).parent().siblings(".detail-right-input-area").find("p")。已完成。
19. 遍历 input。查遍历的方法。each()。已完成。
20. 测试能否获取到文字。可以获取到。已完成。
21. 替换所有的 position 属性为 data-position，否则获取坐标的时候还要根据类别做多次判断。已完成。  
22. 测试。已完成。
23. 获取坐标。$(this).attr("data-position")。已完成。
24. 打印结果，看结果是否正确。正确。已完成。
25. 获取 ocr 类别中该行是字幕还是花字的 button 的类别。已完成。  
1. 判断是 ocr 区域还是 logo、breed 区域。判断方法是有没有字幕花字 button。已完成。
2. 判断 ocr 区域的文字是字幕还是花字。通过 hasClass("active-zimu-button") 判断。已完成。  
3. 把每一行的结果字典放到数组里。用 push() 方法。已完成。  
4. 处理非 ocr 类别。已完成。  
5. 打印数组，查看结果。已完成。
6. 完成 Ajax 请求函数。改 get 请求为 post 请求。已完成。
7. 传输的数据格式从 query string 改为通过 data 传输。已完成。 
8. 在后台测试是否可以取到数据。已完成。
9. 解决后台取不到数组数据的问题。要通过 JSON.stringify() 转成 JSON 字符串。已完成。   
10. 后台获取前端传入的数据。id、category、input_lines。已完成。
11. 把 input_lines 整理成数据库中的格式。   
12. 先把 input_lines 转换为 python 对象，然后遍历，取出 text 和 position。已完成。
13. ocr 的 position 整理成 8 个坐标值形式。已完成。
14. logo 和 breed 整理成一个列表形式。已完成。  
15. 测试修改一个。测试失败，数据库没有更新。已完成。
16. debug 查找没有更新的原因。没有取到 category，字段名写错了。已完成。
17. 写了两个 category，里层的是多余的，删除，通过外层 input_category 获取。已完成。
18. 测试。测试失败，花字的结果存到了字幕中。已完成。  
19. 修改判断逻辑，字幕和花字放到两个不同的列表中，分别存，分别更新。已完成。
20. 修改代码。已完成。
21. 测试。测试失败，后台报错。字段错误。已完成。
22. 修改代码。已完成。
23. 测试。已完成。
24. 修改逻辑，现在是只有 input 内容改变才可以点击保存，应该是标注字幕和花字、删除、添加、调整顺序以后都可以保存。已完成。
25. 把保存的逻辑提取成一个函数。已完成。
26. 上面所有这些的监听事件都调用保存的函数。已完成。
1. 重构代码。现在的函数太大了，功能耦合严重，不能灵活适应变化。把大函数拆解成一系列小函数。从内层开始。已完成。  
2. 提取 ocr 处理函数。ocr_process_function。已完成。
3. 提取 logo 和 breed 处理函数。logo_or_breed_process_function。已完成。
4. 提取类别判断函数。category_process_function。已完成。
5. 提取 Ajax 请求函数。detail_save_ajax。已完成。  
6. 所有的处理都提取成一个大函数。detail_save。已完成。  
7. 把函数整体从监听 input 改变的事件中提取出来，监听事件改为函数调用。已完成。
8. 标注字幕和花字、删除、添加、调整顺序事件中也调用这个函数。已完成。 
9. 测试。测试失败，保存按钮的事件没有没有生效。已完成。
10. debug 查找问题。判断内容非空的时候，在别的事件中调用的时候，this 发生改变，已经不再是 input 框，所以没有进入分支语句。已完成。
11. 修改 breed 代码，传入 input 选择器。已完成。
12. 测试。已完成。
13. 重构代码，修改代码逻辑。现在每一个点击事件，都要通过不同的方式查找到 input 选择器，代码难以复用，难以维护。改为保存原来的状态，然后监听到事件以后，如果内容发生改变，则可以保存。
14. 还是应该具体问题具体分析，字幕花字 button 点击、删除、上移、下移都应该是可以直接保存，添加按钮以后如果 input 的内容发生变化则可以保存。
1. 解决保存以后标注框消失问题。坐标错误。已完成。
2. 看坐标处理函数，解决坐标错误问题。传入的字幕花字坐标是一个字符串，不是列表，切片造成错误。把字符串转成列表。已完成。
3. 现在没有画框功能，为添加的文字框添加一个默认坐标。已完成。
4. 测试字幕：字幕改为花字、上移、下移、添加、删除。已完成。
5. 测试花字：花字改字幕、上移、下移、添加、删除。已完成。
6. 解决删除以后找不到选择器的问题。删除以后选择器也被删除，找不到选择器。已完成。
7. 删除对 p 标签的依赖，改为一个永远会存在的 DOM 元素。改为区域选择器。已完成。  
8. 测试 logo。测试删除功能。测试失败，删除不成功。后台功能还没有实现。已完成。
9. 实现 logo 视图函数。已完成。
10. 现在的判断是非空才可以保存，但是如果是删除事件，全部都删除，内容为空的时候也应该是可以保存的。修改逻辑，删除非空条件判断。已完成。
11. 测试全部删除以后的保存事件。已完成。  
12. 重构代码。现在视图函数内容过多，把大函数拆解成一系列小函数。已完成。
13. 通过内联手法消除过多的参数。已完成。  
14. 通读 5 遍修改保存代码，每一遍改进一个小地方。修改选择器、修改代码顺序、修改 input_lines 的查找方式、内联减少参数、修改非空判断位置。
15. 解决修改花字以后，花字全部清空问题。重构代码的时候 huazi 写成了 huazhi。已完成。
16. 测试。在 tests.py 中添加测试用例。
17. 添加 ocr 修改、删除、调整顺序、添加测试用例。已完成。
18. 添加花字修改、删除、调整顺序、添加测试用例。已完成。
19. 添加 logo 测试用例。已完成。
20. 运行测试。已完成。
21. 更新状态，修改以后，这张图片的这个类别应该改为已修。已完成。
22. 添加修改状态测试用例。已完成。
23. 现在每次保存的时候，所有的图片都会去数据库取出来刷新。正确的做法应该是修改哪一个图片的哪一个类别，应该就只刷新这一个类别。  


# 添加功能 04.29 

1. 找 plus icon。已完成。   
2. 修改 icon 颜色。#aeaeae。已完成。   
3. icon 大小样式变形问题。css 类之间用逗号分隔。已完成。     
4. plus icon 被挤到下一行问题。减小输入框的宽度。已完成。    
5. 先实现 logo 的添加功能。已完成。      
6. 找 plus icon 的 id。没有 id。已完成。    
7. 给 plus icon 添加 id，id 为字符串拼接数据库 id。已完成。   
8. 给每一个类别添加自己独特的 class 属性，用于监听点击事件。已完成。    
9. 写 click 事件，只在控制台输出 log。已完成。   
10. 解决筛选以后 click 事件不起作用问题。把事件写在了 get_detail_ajax 函数里。已完成。   
11. 获取容器。已完成。   
12. 在容器中添加 one-line-input。已完成。   
13. 写 jQuery 删除功能。已完成。   
14. 解决点击 detail-delete-icon 事件不起作用问题。因为新添加的 div 其实并不存在，所以拿不到，原有的可以发挥作用。已完成。    
15. 写字幕花字的添加功能。            
16. 添加一行按钮变形问题。少一个外层的 div。已完成。    
17. 清空添加的文字。用 attr("text", "") 没用，因为没有 text 这个 attr。最后用的是 empty()。已完成。   
18. 解决清空文本把自己也清空了的问题。通过 clone() 实现 DOM 复制。已完成。   
19. ocr 顶部添加按钮通过 prepend 添加字幕 input-line。已完成。   
20. 给新添加的 input-line 绑定事件。$(document).on("click", ".detail-delete-icon", function () {}。已完成。        
21. 实现上下调整顺序功能。已完成。   
22. 实现字幕花字按钮功能。已完成。   
23. 实现保存禁用样式。已完成。
24. 设置 button disabled 的时候的背景颜色。已完成。   
25. 修改按钮 cursor。改 cursor 样式为 default。已完成。   
26. 先完成 logo 的保存按钮样式。   
27. 默认为 disabled。已完成。  
28. 监听 one-input-line 的 change 事件。不是 change 事件，contenteditable 用的是 input 事件。已完成。      


# 列表页链接 04.28  

1. 找 icon。已完成。    
2. 添加 icon。已完成。   
3. 调整样式。已完成。   
4. 重构 video-title 代码。已完成。  
5. 解决代码自动跳转到详情页问题。已完成。   
6. a 链接在新窗口打开。target="\_blank"。已完成。  
7. 解决点击标题没有办法跳转问题。拼接 onclick() 函数。已完成。      
8. 再次解决自动跳转问题。在后面绑定 click()。已完成。   


# 详情页标注框展示 04.26     

1. 解决图片变形问题。已完成。   
2. 学习 opencv 的用法，获取图像的宽高。已完成。   
3. 在 detail 页面，获取封面图的原始坐标。已完成。   
4. 根据 vid，获取 img_name 的第一张，然后拼路径。已完成。   
5. 看 jQuery 是怎么拼图片路径的。已完成。   
6. opencv 读图片路径，获取图像大小，并添加到返回值。已完成。   
7. 返回的每一个类别中，绑定 position 坐标属性。已完成。   
8. 重构代码，详细页的处理放到后台。已完成。   
9. 解决 PyCharm 自动运行测试的问题。删除重新配置。已完成。   
10. 搜 html 添加属性。data- 开头。已完成。   
11. 获取 ocr、logo、breed 的坐标值。已完成。   
12. 重构 js 里拼接字符串代码。已完成。   
13. 添加坐标属性。已完成。   
14. 获取坐标值。已完成。   
15. 把坐标值转换成数组。已完成。         
16. 重构 HTML 代码。已完成。     
17. 转换 ocr 坐标。已完成。    
18. 学习 canvas 的用法。canvas 绘制矩形框用的是 strokeRect，边框颜色是 strokeStyle，清空框用的是 clearRect，线宽是 lineWidth。已完成。   
19. 添加一个 canvas，指定宽高：width: 266px; height: 472px。已完成。   
20. 获取浏览器图片的宽高。已完成。
21. 给 canvas 添加 style 属性。通过 .css() 添加。已完成。      
22. 先实现画一个 img。已完成。
23. 给 img 添加 id，绑定图片在数据库里的 id。已完成。
24. 在一个 img 上添加框。已完成。      
25. 图片外层再添加一个容器。已完成。         
26. 修改复选框、原图按钮、黑色背景样式。给 已完成。 
27. 画框。已完成。
28. 确定 id 属性设置规则。全部使用 sql_id。已完成。   
29. 先不根据比例算，先在在 console 里，在一个图片上直接画一个框试试。已完成。
30. 算比例。已完成。   
31. 把原宽高绑定在一个属性上。已完成。
32. 坐标转换。已完成。    
33. 数组中的每个元素做类型转换。map。已完成。
34. 确定 OCR 坐标含义。看尼尔森 OCR 代码。left_upper, right_upper, right_bottom, left_bottom。已完成。   
35. 确定 LOGO、breed 坐标含义。 左上角和右下角坐标。已完成。  
36. 看看能不能把坐标处理放在后台。不好弄，坐标是在前台解析的。已完成。    
37. 先拿到所有的坐标。用 parents() 和 find()，再加属性选择器。已完成。   
38. 怎么根据是否包含某个 attribute 筛选。$(this)[0].hasAttribute()。已完成。        
39. 先画 logo 和 breed。已完成。
40. 数字四舍五入。Math.round(num)。已完成。    
41. 确定边框颜色。（字幕：绿色） （花字：红色） （logo：橙色） （品种：紫色）已完成。     
42. 坐标取最大值，解决文字倾斜的时候标注框覆盖不全的问题。已完成。   
43. 画字幕和花字。已完成。   
44. 重构代码。消除重复。已完成。    


# 列表页筛选功能 04.20   

1. 先实现下拉框的展示。已完成。      
2. 后台获取 logo，写 logo 接口。已完成。    
3. 和 detail 一样，要遍历 video_id_list。已完成。   
4. 后台做 logo 去重。已完成。   
5. 解决搜索结果重复问题。加 distinct。已完成。    
6. 重构代码。查询改成 Q 查询。已完成。   
7. 测试。已完成。   
8. 重构 js 代码。把 success 里的代码提取为函数。已完成。    
9. 在 js 里写对 logo 接口的请求。已完成。   
10. debug 看怎么解析 JSON 数据。已完成。   
11. 解决请求报错。没有上传 urls.py。已完成。   
12. 解决 JSON 解析报错问题。replace 单引号为双引号。已完成。         
13. 确定有几层 for 循环。三层。已完成。   
14. logo 按字母排序。已完成。  
15. 重构代码，把主要功能都移到 views_utils.py 里。已完成。  
16. 创建几个 logo 测试数据。已完成。   
17. debug 解决详细页报错问题。添加完数据以后，有一个 cell 从 Null 变成了空字符串。前端处理还是非常的不 robust，还是要把处理移到后端。已完成。   
18. 修改 HTML 容器 id。已完成。         
19. 添加测试。已完成。  
20. 解决测试不通过问题。数据库数据有问题。已完成。
21. 前端 select 替换为动态数据。已完成。   
22. 后台获取 breed，写 breed 接口。已完成。   
23. 优化代码，抽取函数。已完成。   
24. 测试。已完成。   
25. 解决测试失败问题。变量重名了，重新起一个名字。已完成。    
26. 写 breed 测试代码。已完成。   
27. 在 js 里添加对 breed 的请求。已完成。   
28. 动态替换 breed。已完成。      
29. 写下拉框 change 事件。已完成。  
30. 修改 js 函数，可以传递下拉框文本。已完成。    
31. 写视图函数，处理请求。    
32. 修复详情页视图函数和列表页视图函数 logo 和 breed 筛选的逻辑错误。不应该走 search 函数，而应该是在各自的字段里进行查询。已完成。   
33. 解决测试报错问题，ValueError: Cannot use None as a query value。查询字段传值有问题。没有上传 js 文件。没有在测试中添加参数。已完成。    
34. 测试筛选。先测试单个。已完成。    
35. 写 response 返回元素的个数的测试。已完成。      
36. 测试筛选关系且关系。已完成。   
37. 搜索和筛选是且的关系。修改代码逻辑。已完成。
38. 修改 js 代码。已完成。
39. 测试。已完成。
40. 上传 gitlib。已完成。   


# 详情页筛选功能 04.19   

1. 先实现下拉框的展示。已完成。    
2. 先实现获取。已完成。
3. OCR 不用获取。已完成。  
4. 后台获取 logo。已完成。  
5. 修改 HTML 容器 id。已完成。
6. jQuery 遍历打印 logo。已完成。  
7. select 不要删除第一行类别。已完成。      
8. select 怎么添加 value 属性。已完成。   
9. logo 转换成 JSON 格式，只提取文字。已完成。   
10. logo 结果去重。已完成。   
11. 修正 logo 为需要的形式。已完成。
12. JavaScript 判断元素不在数组中。已完成。
13. 实现 logo 按字母排序。已完成。  
14. 实现品种展示。已完成。
15. 获取 select 下的 option。使用 eq() 选择器。已完成。   
16. 实现获取下拉框文字。.text()。已完成。      
17. 监听下拉框的 click 事件。不是 click 事件，是 change 事件。已完成。  
18. 实现点击获取文字。已完成。    
19. 实现单个搜索。已完成。
20. 解决单个搜索造成的下拉框只显示当前类别问题。已完成。        
21. 显示下拉框的函数不应该写在 res 的 success 后面。应该另写一个接口，专门获取下拉框列表。已完成。      
22. 把展示功能提取到一个新的函数中，在 success 里调用函数。已完成。    
23. 学习 value 和 value_list 的用法。已完成。      
24. 写视图函数。已完成。  
25. 写 url 路由。已完成。
26. django QuerySet 转 dict。已完成。  
27. 传参数的时候，加上 vid。已完成。
28. 写测试。已完成。
29. 配置 tests。已完成。
30. 写一个最简单的测试。已完成。  
31. 一点一点取消测试。已完成。  
32. 换成 django 测试。已完成。
33. 解决找不到数据表的问题。已完成。        
34. 解决前端不显示下拉列表问题。没有传 vid 参数。已完成。   
35. 获取品种下拉框文字。已完成。    
36. 写品种视图函数。已完成。  
37. 写视图 url。已完成。
38. 写测试。已完成。   
39. 写请求 js。已完成。
40. 写搜索 js。已完成。
41. 实现多个下拉框搜索且关系搜索。已完成。   
42. 创建几个假数据，达到既有 logo，也有 breed。logo 和 breed 都不止一个。已完成。   
43. 解决 logo 显示为空的 bug。括号不配对。已完成。   
44. 先实现 value 为 0 的时候不搜索。已完成。    
45. 解决 value 判断报错问题。attr() 用法不对。已完成。   
46. value 为 0 的时候，应该触发查全部。已完成。   
47. 实现有无 OCR 筛选。已完成。
48. 先写视图函数。用 exists 判断。用 isnull 判断。已完成。                
49. 查看 OCR 筛选效果。已完成。   
50. 重构代码。已完成。
51. 先优化搜索功能。已完成。
52. 每一个下拉框传一个自己的字段。已完成。   
53. check_siblings，每次 change 事件都会去检查其他下拉框的值。已完成。   
54. 拿到所有的下拉框的值。直接用 id 来取。已完成。   
55. 每一个都是非 0 才拼接。全部只传文本，所有的处理都放在后台。已完成。   
56. 优化 Q 表达式。已完成。   
57. 写后台处理逻辑，拼查询条件。已完成。    
58. 获取 ocr、logo、breed 文本内容。已完成。    
59. 分支判断。已完成。   
60. 提取 search_word 函数。已完成。  
61. 解决传递参数为空字符串问题。加默认值。已完成。   
62. 测试，测试单个筛选。已完成。    
63. 解决 OCR 筛选不生效问题。无OCR 的时候应该是且关系。已完成。   
64. 测试多个筛选且关系。已完成。    
65. 确定搜索和筛选的关系。是否是在搜索结果上进行筛选。是否在筛选的结果上进行搜索。搜索和筛选是且的关系。已完成。      
66. 上传 gitlib。已完成。


# 列表页修改状态展示 04.15       

1. 获取修改状态。已完成。    
2. 看数据库视频表的字段。不在视频表里，而是在详细页表里。已完成。    
3. 看详细页表字段。已完成。
4. 确定逻辑。有一个未修就是未修，所有都修过才是已修。已完成。      
5. 分别获取各个字段。已完成。
6. 看怎么获取整体的结果。用 all 或者 any 判断。已完成。   
7. 在列表视图函数里获取详情页的状态。已完成。
8. 先写 logo 视图。已完成。
9. 查看 Python all 的用法。已完成。  
10. 确定数据库返回的数字的类型是字符串还是数字。字符串。已完成。   
11. 要把返回的字符串转换成数字。已完成。  
12. 获取 logo 修改状态。已完成。
13. 获取 breed 修改状态。已完成。  
14. 获取单张图片 ocr 和 flower 状态。已完成。   
15. 字幕花字有一个修改就是已修状态。已完成。
16. 所有图片的都修改整个视频才是已修状态。已完成。
17. 提取列表页右侧的状态行。已完成。  
18. 怎么给容器添加动态的 id。先试试 append。不行。已完成。
19. 学习 jQuery 的 each 的用法。已完成。    
20. 先走通静态页面添加 button。已完成。
21. 根据返回的状态结果，替换行。已完成。   
22. 测试结果。已完成。
23. 获取 video 的 id。已完成。
24. debug js，获取返回状态，看修改没有起作用的原因。是 modified 不是 modify。已完成。   
25. 测试花字和 ocr。已完成。
26. 查看为什么有个视频点进去详细页面是空的。已完成。
27. 找图片存放的位置。已完成。       
28. 优化 js 代码，提取到一个函数里，消除重复。已完成。  
29. 查 jQuery 的 split 的用法。已完成。   
30. 上传 gitlib。已完成。


# 过拟合和交叉验证 04.14  

1. 读课程，听课程，听 20 遍   
2. 读《动手学深度学习》
3. 读《统计学习方法》
4. 读《机器学习》
5. 读《深度学习入门》  
6. 读《Keras》
1. 过拟合非常重要。训练模型，很多时间都是用在了解决过拟合问题上。   
2. 什么是过拟合  
3. 为什么会有过拟合（算损失）
4. 奥卡姆剃刀
5. 决策树
6. 信息熵，信息增益
7. 剪枝  
8. 线性回归
9. 正则化，L2 范数    
10. 什么是 R 方分数    
11. 为什么要有验证集。
12. 什么是交叉验证。
13. 随机森林。   
14. 解决过拟合的方法。500 问。  


# 列表页搜索 04.13   

1. 确定搜索范围。ocr、logo、品种。已完成。      
2. 写视图函数。已完成。  
3. 写查询条件，搜索字段内容。已完成。
4. 获取 video_id。已完成。   
5. 写 HTML，添加搜索 button id，修改 CSS 样式。已完成。  
6. jQuery 获取输入框内容。已完成。   
7. debug 视图函数，走通最开始的流程。已完成。   
8. 修改模型文件，添加外键约束。已完成。   
9. 解决字段名 clashes 问题。已完成。
10. 修改字段名，解决报错问题。已完成。   
11. 测试在 models 里添加数据库没有的字段能不能进行查询。不行，必须要用已有的字段。已完成。
12. 删除远程环境。已完成。
13. 重新配置远程环境。已完成。
14. 本地安装 Django。已完成。   
15. 读 Django 文档，找外键查询的方法。已完成。   
16. 学习 ForeignKey。已完成。   
17. 外键查询。已完成。   
18. 删除 PyCharm 远程环境配置。已完成。
19. 删除远程和本地文件夹。已完成。  
20. git clone 远程和本地文件夹。已完成。   
21. 重新配置 PyCharm 远程连接。已完成。   
22. 卸载原来的环境。已完成。  
23. 重新安装新的环境。已完成。
24. 重新配置远程连接。已完成。   
25. 复制 Django。已完成。   
26. 学习 Linux 的 zip 和 unzip 命令。已完成。   
27. 修改 models 字段，添加外键。已完成。  
28. 跨关联关系查询。已完成。   
29. 查询结果按 video_id 去重。已完成。   
30. 查询结果按上传时间倒序排列。已完成。
31. 解决排序不生效问题。已完成。
32. 优化 NielsenItem 模型和 NielsenUpload 关系。添加外键。已完成。      
33. 上传 gitlib。已完成。   


# 详细页搜索 04.12  

1. 确定搜索范围。ocr、logo、品种。已完成。   
2. 看科技搜搜是怎么实现搜索的。已完成。   
3. 看 django 官方文档，看数据库多字段搜索。已完成。   
4. 写视图函数。已完成。   
5. 写 url 路由。已完成。     
6. 写 jQuery 函数。已完成。
7. 获取搜索框内容。已完成。
8. 怎么调用 get_detail_data 函数。已完成。
9. 怎么区分是搜索还是普通访问。已完成。
10. 看海上装备代码。已完成。
11. 删除搜索的视图函数和 url 路由。因为搜索和展示用的是同一个视图函数。已完成。           
12. 先用最简单的方法解决查询问题。先走通流程。已完成。
13. 解决查询结果布局错位问题。img_area.empty()。已完成。
14. 上传 gitlib。已完成。


# 列表页点击进入详情页 04.12    

1. 参考原来的跳转办法。window.location.href。已完成。
2. 先实现最简单的跳转。已完成。  
3. 绑定 video_id。已完成。   
4. 怎么携带参数。已完成。   
5. 参考原来的代码，绑定 onclick 函数。已完成。
6. 修改视图函数，接收 vid 参数。已完成。  
7. 修改 url，添加 id。已完成。
8. 两个视图，两个 url 都要添加 vid。已完成。    
9. jQuery 获取 id。已完成。
10. jQuery 发送 Ajax 请求。已完成。   
11. 原来的请求方式，找静态文件的时候会有问题，更改请求方式。已完成。
12. 使用 localStorage 存取 video_id。已完成。
13. 测试效果。已完成。       


# 替换列表页内容 04.11  

1. 写视图函数。已完成。
2. 查 filter in 方法。已完成。
3. 写 jQuery 文件的 Ajax 请求。已完成。   
4. 测试流程有没有走通。已完成。    
5. 写测试。已完成。
6. 先试试展示一个视频。已完成。
7. 看 img 的 src 是怎么找的。已完成。
8. jQuery 遍历返回的结果。已完成。    
9. 拆解 video 函数。已完成。   
10. 替换 video。已完成。  
11. 替换 title。已完成。    
12. 每一行加竖直滚动条。已完成。
13. 修改 a 链接字号。已完成。  
14. 加完成状态过滤。已完成。   


# 替换详细页右侧内容 04.10    

1. 动态替换品种。已完成。  
2. 动态替换字幕。已完成。    
3. 动态替换花字。已完成。   
4. 解耦 HTML。已完成。    
5. 图片排序。已完成。


# 动态替换改为 jQuery 形式 04.08  

1. 缩略图页面继承 base.html。已完成。
2. git 备份。已完成。   
3. 删除 Django 语法。已完成。
4. 复制内容到 js 文件。已完成。   
5. 查 jQuery 中 Ajax 用法。已完成。    
6. 读 Ajax 用法。已完成。
7. 复制 Ajax 内容到 js 文件。已完成。
8. 看 url。detail。已完成。
9. 看原来项目返回的数据的类型。已完成。   
10. 怎么找到 html。已完成。
11. 先实现展示功能。已完成。


# 优化尼尔森字幕花字提取 04.06  

1. 优化代码。已完成。   
2. 增加 set 相似度去重。已完成。   
3. 遍历 set 以后的结果，再按 75% 去重。已完成。     
4. 找 difflib 去重的代码。已完成。    


# 详情页面动态替换 04.03     

1. 看数据库，重新跑 inspectdb。已完成。    
2. 添加 for 循环。已完成。   
3. 重构静态文件，添加 base.html，解决详情页面访问静态文件路径错误问题。
4. 替换图片。已完成。   
5. 静态文件路径。已完成。
6. 动态配置路径。已完成。   


# 集成静态文件，后端前期配置 04.01   

1. 实现 Django 集成静态文件。已完成。        
2. 更改左上角链接。已完成。  
3. 修改 favicon.ico。已完成。
4. 配置数据库。已完成。   
5. inspectdb。已完成。      


# 标注检查工具详细页静态页面 03.30   

1. 复制 HTML，复制 CSS。已完成。   
2. 调整箭头大小。已完成。
3. 改箭头背景颜色。已完成。     
4. 改箭头和按钮左右间距。已完成。   
5. 更改竖直间距。已完成。
6. 展开箭头布局。已完成。  
7. 展开 button 布局。已完成。   
8. input 展示内容。已完成。   
9. input 的 border 不显示。已完成。   
10. 设置 input 的 border 样式。已完成。   
11. input 指定长度。已完成。    
12. 多行样式。已完成。
13. input 换行。已完成。   
14. input 对齐。已完成。   
15. 添加 delete icon。已完成。
16. 字幕 button 设置。已完成。    
17. arrow 样式。已完成。   
18. arrow 同一行。已完成。         
19. css 写到 css 文件里。已完成。       


# 海上装备适配问题 03.26  

1. 看 bootstrap 栅格文档。已完成。
2. 改浏览器大小。已完成。      
3. 停掉服务器后台。已完成。   
4. pycharm 起服务。已完成。    
5. 先改一个页面。已完成。   
6. 改所有页面。已完成。      


# 标注检查工具列表页静态页面 03.25     

1. 顶部背景颜色。已完成。   
2. 左上角下拉框。已完成。   
3. 左上角下拉框背景颜色。已完成。
4. 搜索框，搜索 icon 融合到按钮里。已完成。
5. 筛选下拉框，布局。已完成。   
6. 筛选下拉框，定位，宽度。已完成。   
7. 右侧每页显示多少条。已完成。   
8. 视频区域定位。已完成。   
9. 展示视频封面。已完成。  
10. 展示视频 title。已完成。   
11. 右侧按钮区域布局。已完成。   
12. 右侧 label 和 button 布局。已完成。   
13. button 对齐；背景颜色；扁平化；内部文字线宽、颜色。已完成。      
14. label 对齐。已完成。   
15. 页码。已完成。   
16. select 选中后有黑框。已完成。   


# 专家观点库搜索速度慢 03.22  

1. 怎么查两个索引。已完成。   
2. 怎么开多线程。已完成。   
3. 怎么判断哪一个先返回。已完成。
4. 怎么杀线程。已完成。     


# 创建一个新索引，只存姓名全称 03.19     

1. 创建索引模板。已完成。   
2. 从原始数据里取数据。已完成。   
3. 上传到新索引。已完成。       
4. 新索引是怎么按月份分索引的。已完成。      
5. 把跑数据脚本存成一个标准的存取数据的代码，以后参考。已完成。      
6. 定时任务。已完成。      


# 运行标注检查工具源码 03.16   

1. 找服务器。b62。已完成。
2. 创建虚拟环境。已完成。   
3. 安装包。已完成。  
4. 测试网站是否可以运行。已完成。 
5. git clone 源码。已完成。   
6. 运行源码。已完成。  
7. 创建 sqlite 数据库。已完成。   
8. 删除环境重装。已完成。       
9. 配置 PyCharm。已完成。   
10. 下载文件。已完成。   


# 找标注工具开源项目 03.16 

未完成，最后是彭老师找到的。寻找方法不对。应该找能用的，仔细看。结果是走马观花，忘记了自己可以修改。   

看百度标注网站的源码   

功能：web 工具；修改标注结果，添加、删除、修改；一屏多张图片；可以指定打开路径，可以指定保存路径。

查看方法：看动图，看 UI，看功能、看 readme 标题、看 readme   

1. CVAT，web 工具，docker 安装，没有找到缩略图显示功能；没有找到编辑标注框的功能      
2. COCO Annotator，web 工具，docker 安装，没有安装，看着挺好            
3. VoTT，archived 
4. EVA，web 工具，没有安装，看着挺简陋，安装要求还特别多   
5. LOST web 工具，docker 安装，看着不错    
6. Ybat，好安装，但是非常简陋，功能太少   


# 海上装备从原来数据库导出数据到现在数据库里 03.15

1. 创建一个新的 .py 文件。已完成。   
2. 看原来代码。已完成。  
3. 找到表对应的模型。已完成。    
4. 看表之间的关系。已完成。   
5. 复制模型。已完成。     
6. 确定模型代码放在哪里。要不要和本来就有的模型放在一起。看是不是有重名的模型。新建一个模型文件。已完成。    
7. 看字段含义。已完成。   
8. 看需要哪些字段。看之前的命令。已完成。
9. 数据库配置。看原来的代码。已完成。   
10. 官方文档看 Django 多数据库配置。已完成。
11. 去官方文档查 using 的用法。已完成。   
12. 开始写命令。已完成。
13. 解决导包问题，看之前的代码是怎么导包的。已完成。
14. 类改名字。已完成。
15. 从数据库查询，再 print，走通取数据流程。已完成。   
16. 先处理一条。已完成。     
17. 复制之前的命令。已完成。
18. 查原来是怎么从 task 找到 paper 的。已完成。   
19. 再遍历所有。已完成。
20. 解决 posts 累加问题。已完成。   
21. 判断 public_year 为空。已完成。  


# 优化专家观点库搜索速度 03.15   

先用 filter 优化搜索   
1. 看网上文章里的例子。已完成。  
2. 在 kibana 试。已完成。   
3. 看科技搜搜。已完成。   
4. 改代码为 filter。已完成。  
5. 验证效果。已完成。
6. 做笔记。已完成。


# 上科院项目上传文件 03.14      

关键是理解代码的意思，弄明白原来文件的格式       

要 debug 原来的代码   

1. 下载 Excel 文件。已完成。    
2. 创建 .py 文件。已完成。
3. 上传 Excel 文件到服务器。已完成。   
4. 复制代码。已完成。
5. 解决导包问题。已完成。   
6. 看用到了哪些字段，看 request。已完成。   
7. 创建用户。已完成。   
8. 先读三遍原来的代码。已完成。
9. debug 原来的视图函数。已完成。  
10. 重构代码。已完成。
11. 先读一个文件。已完成。   
12. 替换字段。已完成。
13. 写成 command。已完成。     
14. 替换 user 实例。已完成。   
15. 重构代码。已完成。
16. 解决文章覆盖问题。已完成。    
17. 替换 nan 为空。已完成。   
18. 上传数据。已完成。      



# 标签转换 03.08    

总体原则：  
不干扰原来的代码。  
写一个转换命令。  
voc 转换结果存在一个新文件夹里，自己通过复制实现展示。    

1. 转换什么时候的数据。最最后的结果，有 is_zimu 字段。已完成。
2. 新建一个 .py 文件，专门处理标签转换。已完成。
3. 在 run.py 中调用新文件的接口。已完成。    
4. 保存为 txt 文件，一张图片是一个 txt。已完成。
5. 看猫狗识别的文件。看看是什么样式。已完成。
6. 弄明白猫狗识别的 txt 标注文件中坐标的含义。txt 中的坐标的含义是：xmin、ymin、width、height。已完成。
7. 看文档里命令的路径。已完成。
8. 会不会影响已有的 CSV？是不是要新建一个文件夹。需要新存一个 txt 文件夹。已完成。
9. 两个 OCR 识别结果不一致的问题。解决办法是要到 CSV 文件，自己这里跑字幕花字分离，自己这边处理。已完成。    
10. 同一张图片的多行字幕怎么拼接。已完成。
11. 转换成什么格式。VOC 格式。已完成。
12. 找到之前的代码。已完成。
13. 坐标转换。怎么简单怎么来。取图片高度。已完成。
14. 把转换的命令代码写成一个 .py 文件。已完成。
15. 写转换 VOC 的代码，要注意的事情是只取有字幕的文件，也就是先遍历 txt 文件夹，然后再根据文件名取 img。已完成。
16. 转换结果存到什么地方。应该和图片放在同一个文件夹下面，然后要写一个删除的参数，实现删除的功能。已完成。
17. 放在同一个文件夹下，会不会影响读取图片。实现删除图片文件下所有 .xml 功能。已完成。
18. 在 run.py 中实现 if 判断，不要每次都注释。已完成。
19. 这个版本上传到自己的 gitlab 上，新建一个项目 extract_subtitles2。已完成。    


# Redis 存搜的词，可以按时间删除 03.08  

1. 怎么存。时间为键，词为值。时间精确到秒。已完成。    
2. 第一天存了，第二天又存，怎么弄。不影响。已完成。
3. 怎么创建出字典。已完成。
4. Redis 怎么存数据，怎么存字典。redis.set()
5. 怎么取。redis.get()   
6. 取出来怎么判断。已完成。   
7. 怎么判断一天前。已完成。
8. 时间大小怎么比较。已完成。
9. 怎么删，遍历删。已完成。   
10. 怎么删除 1 天前的搜索记录。已完成。   


# 专家观点库设置定时任务 03.07   

怎么设置定时任务，看科技搜搜代码        
1. gitlab 看科技搜搜跑数据定时任务。已完成。  
2. gitlab 看科技搜搜跑数据代码。已完成。
3. 改专家观点库代码。已完成。
4. Linux 怎么设置定时任务，看 PDF。已完成。
5. 设置命令。 


# 机器学习课程 03.03  

1. 整理飞书笔记。已完成。   
2. 什么是机器学习，能干什么。已完成。       
3. 模型。训练和预测。已完成。
4. 什么是权重。已完成。    
5. 什么是分类问题，什么是回归问题。已完成。
6. 回归是什么意思。已完成。
7. 什么是梯度。就当做斜率就可以。已完成。 
8. 梯度下降。百度，吴恩达。已完成。   
9. 求导公式。百度。已完成。
10. 《d2l》。已完成。


# 字幕重构，去重优化 03.01  
改成类。已完成。  
CSV 第一列改格式。已完成。   
时间和帧数不是完全对应的，还要看切帧的频率。已完成。  

最后处理结果，按帧前后去重，去重规则：  
1. 如果当前帧的 time 大于等于 3 秒，就遍历前面 3 秒的帧。已完成。     
2. 如果当前帧的 time 小于 3 秒，就遍历前面所有的帧。已完成。       
3. 持续出现的，解决重复的问题。已完成。   

结论：   
大体上字幕是可读的。主要是改成了类，然后就可以实现按帧去重，之前是取列表后 3 个，有问题上下取 3 行。    
1. 花字，也就是背景字，有非常多重复的。50 多个视频，字数多 3 万多字，每个视频多 600 字，主要是包装袋。而且慢了很多。if 当前 not in，就 append 到 huazi_list   
2. 字幕，换了按时间去重以后，50 多个视频，字数减少 600 多字，每个视频减少 10 几个字，因为按帧去重更彻底。  
3. 不能用 not in，因为看了几个，确实是说话会有重复的。比如一款猫粮，然后说配方前三位是。下一款又说配方前 3 位是。比如有一个连续拍了 5 天的视频，每一个最开始都说 哈喽，我叫什么。    
4. 最突出的是几个问题：跳动字幕还是没有办法。现在没办法，后面做成工具也是没办法。
5. 背景包装袋，字的大小差不多。没有办法区分前景背景，彦彬最后是去知网看论文了，看了。
6. 字幕下面有稳定的字，会有重复的问题。比如包装袋，最多的问题。比如聊天记录，比如标题。可以解决。 
7. 漏字不是一个严重的问题。我看了十几个，我看到的是漏了三四句。重复的问题更严重一些。   
8. 怎么做测试呢？怎么知道效果好了呢？我现在的办法就是读，凭感受。   

看 10 个视频视频，验证效果。已完成。   


# GPU 准备工作 02.26  

把 opencv 的视频过一遍。已完成。  
GPU 部署。已完成。  
跑视频。已完成。     
连 pycharm。已完成。    
conda -c 参数含义。已完成。    
添加 try_except。已完成。   
log 添加 文件名。已完成。  
log 日志，第几帧。已完成。   


# 跑抖音视频，看效果 02.24

1. 取前 100 个视频。已完成。  
2. 放在什么文件夹下。已完成。  
3. 传到本地。已完成。  
4. 保存中间识别过程。就是 CSV 文件。已完成。  
5. 展示最后结果。已完成。  
6. 看哪里有问题。已完成。  


# 字幕花字提取优化 02.22   

1. debug 重复问题。已完成。
2. 去重的效果，在一组里是很好的，但是在整体里，效果不好。因为会离得很远，比如小红书，还有上下多句的问题。好处是，可能凑不够 5 条，就全部都是花字。不如之前效果好。
3. 识别结果按 y 轴排序。已完成。
4. 最开始分组的时候加了高度限制，效果大幅提升。
5. 多次测试，找到合适的高度限制。

1. 字幕和花字的消重问题。之所以会有这个消重问题，是因为切帧，会有相同的图片。一个位置就是一个组，这里面是只有高度，没有宽度的限制。只比较最后一个，就消除不掉。做了判断。
2. 排序问题。之前不是个问题，是因为按帧往下走的。有一个排序，是按照文件名排的。但是对于同一张图片里的文字，是乱的，之前看不出来，但是现在多行字幕，就会有这个需求。所以最后就是，先按图片名排，同一张图片里再按 y 轴坐标，从上往下排。


# 把 notebook 转换成脚本 02.17  

1. add_argument 怎么写？参考 zjgdk。已完成。  
2. 文件夹版本。已完成。    
3. 获取路径最后的文件名。已完成。    
4. 获取文件名的去除后缀的名称。已完成。    
5. 名称按 _ split，取索引为 0 的真正的名称。已完成。    
6. 输入的路径参数，不管带不带斜杠，都要能够正常运行。已完成。     
7. label 判断，是猫狗的时候才替换。已完成。  
8. 没有参数报错提示。已完成。  
9. 单元测试。已完成。  
10. 文档。已完成。  


# annotation 格式转换 02.14 

1. 现有的标注样式  
2. VOC 格式的标准样式  
3. 读 github 上 labelImg 转 VOC 的代码  
4. 先转换一个文件  
5. 转换所有文件  


# 首页表格显示 02.11  

1. 查哪个表。mx_task_info 表  
2. 对应的是哪个模型。TaskInfo 模型    
3. 上传成功是什么状态，没有上传成功是什么状态。上传成功是 6，没有上传成功是 7      
4. 写视图函数
5. Ajax 请求 
6. 在什么时候请求  
7. 在哪里写请求  


# 多次上传文件 02.10   

1. 读完 jQuery 代码，复制出来有用的东西。         
2. 获取已经有的文件。  
3. 把文件添加到列表。  
4. 取消现在 input 的 label  
5. 添加新的 label     
6. 获取上传文件的文件名    
7. 最后上传的是列表中所有的文件。 
8. 在点击取消和新建以后，重置列表      
9. 多个文件上传以后，鼠标悬停的信息的展示。tooltips    


# 热词项目核心功能 01.30 

1. 搭建环境。已完成。    
2. 读取 Excel，判断空行。已完成。   
3. 判断第一行，提取人名。已完成。     
4. 取非人名文本。已完成。  
5. 分词。已完成。    
6. stopwords。已完成。  
7. 统计词频。已完成。    
8. 按词频排序。已完成。  
9. 人名次数统计。做一个字典映射，把这个人说过的话的分词结果都放到值中，拿到排序结果以后，遍历统计，得到每个词对应的用户，最后取用户的个数。已完成。      
10. 自己配置词性功能。已完成。  
11. 人次组合到元组里。已完成。    
12. 优化整合代码；已完成。
13. 写视图函数。已完成。


# 单句模型交叉验证 01.23  

1. 找到网址。ifconfig 找到网址。已完成。  
2. notebook 的 token。vim /home/crisis/logs/notebook.log，复制日志的 token。已完成。  
3. 找到原始的单句数据集。single_sentence.json。已完成。    
4. 找到新的样本数据。v13/危机预警系统数据12.17.xlsx。已完成。  
5. 从新数据中找到所有的单句。已完成。  
6. 合并数据集。这一步不用做，直接用最新的模型做 fine-tune 就好了。  
7. 用逗号隔开 keyword。已完成。  
8. 训练一个单句模型。已完成。  
9. 训练多个单句模型。已完成。  
10. 修改代码，适应单句模型 predict。已完成。  
11. 完成交叉验证。已完成。    



# 海上装备后台用户页面 01.20 

1. 先做提示：如果为空，就提示请输入。已完成。  
2. 复制提示信息样式到 HTML 文件中。已完成。  
3. 解决确认密码不提示问题。已完成。  
4. 输入框变化，提示信息隐藏。已完成。     
5. 实现密码验证功能。已完成。  
6. 再次点击，清空输入框。已完成。  
7. 修改密码弹框，再次点击，清空输入框。已完成。    
8. 下拉框对应数字。已完成。  
9. 弄明白上传文件和修改权限的下拉框处理逻辑。已完成。    
10. 用户展示接口。已完成。
11. 写后端接口。已完成。  
12. 遍历结果。已完成。    
13. 添加用户接口。已完成。  
14. 添加用户完成以后，清空输入框。已完成。  
15. 用户表格滚动条。已完成。    
16. 删除用户接口。已完成。  
17. 先删除一条，跑通接口。已完成。    
18. 根据 CheckBox 勾选，修改提示信息，先实现一条。已完成。 
19. 实现提示信息，提示多个用户。已完成。
20. 完成用户名之间的顿号的处理。已完成。    
21. 根据 CheckBox 勾选，删除勾选的这一条。已完成。    
22. 根据 CheckBox 勾选，删除勾选的多条。已完成。    
23. 刚进入网页的时候，删除用户按钮为 disabled。已完成。  
24. 如果没有勾选，删除用户按钮为 disabled；勾选以后为可点击状态。已完成。 
25. 删除用户以后，删除用户按钮为 disabled。已完成。  
26. 实现登录。已完成。  
27. 看 login 视图函数。已完成。
28. 请求 login 接口。已完成。
29. 拿到 token。已完成。
30. 把 token 添加到 headers 里。已完成。
31. 看后端哪里用到了 token。已完成。
32. token 怎么设置成全局变量。（用 localStorage）已完成。  
33. 怎么获取当前用户属性。已完成。  
34. 修改密码接口。已完成。  
35. 完善修改密码接口。已完成。  
36. 先走通修改密码接口。已完成。  
37. 根据用户，实现密码修改。已完成。  
38. 看权限接口代码。已完成。  
39. 走通数据库。已完成。
40. 弄懂 type 是什么，怎么传。已完成。  
41. 走通 permission list 接口。已完成。
42. 根据当前用户的权限，判断左侧哪些内容显示，哪些内容隐藏。已完成。  
43. 通过 jQuery 实现左侧显示？  
44. 实现管理员和研究人员登录按钮。已完成。    
45. 根据用户，在右上角显示不同的用户名。通过视图函数实现。已完成。  
46. 弄清楚链接跳转的流程。已完成。
47. 弄清楚 cookie 和 localStorage 的作用。已完成。  
48. 完成跳转。已完成。  



# 热词统计 01.13  
1. 读 Excel。已完成。  
2. 两列，去空白符。已完成。  
3. 逗号分词。已完成。  
4. 正则匹配。已完成。  
5. 统计词频。已完成。  
6. 循环 update。已完成。  
7. 同义词相加。已完成。  
8. 取最高值。已完成。  



# 专家观点库姓名识别基本功能 01.06  

1. 去治理索引找一篇文章，有人名，有全称。已完成。  
3. 动词匹配。用正则表达式，findall 和 finditer。已完成。  
4. 判断有没有分段。str.find("\n") 或 re.findall("\n") 或者 re.finditer("\n")。已完成。  
5. 如果分段，就在一个段落里找，如果没有分段，就在一句话里找。怎么判断一句话。已完成。  
6. 往前找和往后找。已完成。  
7. 跑词性。已完成。  
8. 找全称的正则。已完成。 
9. 找 PER。已完成。   
10. 把结果合成一个列表。已完成。  
11. 列表排序。已完成。  
12. 实现 name_map。已完成。  
13. 根据姓名相对于动词的位置，进行排序。已完成。    
14. 根据 type，判断是否返回。已完成。  


# 训练模型 01.03    

一、先训练多句模型  
1. 看交叉验证  
2. 准备训练集  
3. 训练模型  
4. 交叉验证  



1. 复制代码。已完成。 
2. 读代码，看用到了哪些函数。已完成。 
3. 把用到的函数复制过去。已完成。  
4. 看调用函数有什么修改。已完成。  
5. 准备训练集。已完成。  
6. 执行一下过程，看看报什么错，进行相应的调整，看看生成的数据的格式  
7. 写 shell 脚本  
8. 完成 predict  


# 重新训练一版多句模型  12.26 

1. 先删除训练的模型。已完成。  
2. 找到 c 和 d 数据。已完成。  
3. 处理第二次标注的 c 和 d 类型的数据，先分组  
4. 根据规则合并 
5. 准备多句模型数据  
6. 多句模型数据标签替换  
7. 合并单句数据  



# 海上装备后台 12.15  

1. 先布局。已完成。  
2. 先创建出一个空页面出来。已完成。    
3. 添加表格。已完成。    
4. 添加管理员三角形。已完成。  
5. 实现弹框。已完成。    
6. 复制粘贴，创建多个页面。已完成。  



# 用第二次标注数据迭代模型 12.11  

1. 上传第二次标注数据。已完成  
2. 找到原始 3 万条单句样本。已完成。train_trainv6_norm.json  
3. 把原始单句样本中的第二次标注的数据的标签，替换为重新标注的标签。已完成。  
4. 合并单句样本和第一次标注的 5000 条样本。已完成。合并以后的数据为 work/v11/train_trainv11_norm.json   
5. 训练模型。已完成。  
6. 找到测试集。已完成。    
7. 测试效果。已完成。  


# 第 2 个单句模型 12.09 

1. 找到重新标注的 5000 条。已完成。是 work/v10/cd_relabel.json  
2. 找到单句样本。已完成。是 clue_classifier/CLUEdatasets/semeval_trainv6/train_trainv6_norm.json  
3. 取第 2 个 5000 条。已完成。  
4. 合并 json 文件，生成训练集。已完成。  
5. 训练模型。已完成。   
6. 准备好测试集。已完成。work/v10/train_trainv6_norm_first_5000.json    
7. 预测结果。已完成。    
8. 用 cleanlab 统计错例。已完成。  



# 单句训练 12.09   

1. 找到标注以后的数据。已完成。在 work/v10/模型反馈样本数据-标注后.xlsx    
2. 转换成 JSON 文件。已完成。重新标注以后的数据在 work/v10/cd_relabel.json  
3. 用标注以后的数据训练一个模型。已完成。
4. 用这个模型在单句样本上测试效果。已完成。  



# 迭代单句模型 12.01 

测试结果  

准备测试数据：  
1. 找到原始数据 290000 样本。已完成。是 work/v8/final_trainv8_norm_290000.json    
2. 找到 c 和 d 类型的数据。已完成。是 work/v8/c_label0_some_preds1.json 和 work/v8/d_label1_all_preds0.json  
3. 把 c 和 d 从原始数据中去除。已完成。  
4. 在去掉 c 和 d 后剩下的数据中随机采样，取一半。已完成。  
5. 找到训练集。已完成。  
6. 在 c 和 d 中去掉重新标注的训练集。已完成。    
7. 把 c 和 d 中剩下的数据拼接到随机采样一半的结果里。已完成。测试集是：half_sample_test_set_with_cd.json    
8. 先用原来的模型在测试集上测试效果  
9. 再用迭代的模型在测试集上测试效果  



# 添加 url、原来的评级和模型预测标签 11.26  

1. 先做预测标签，查生成的 Excel，复制、替换。已完成。  
2. url 和原来的评级一起做，读原始数据，处理成字典格式进行遍历。


# 文本转为 Excel 格式 11.21  

1. 取 10 条做实验。复制粘贴就可以。已完成。  
2. 写入 Excel。已完成。  
3. 写入多个 sheet。已完成。  
4. 写入 Excel 按句子 split。已完成。  
5. 颜色高亮。已完成。    


# 测 LAC 分词速度 11.17   

## 方法 1 

1. 读 CSV 文件  
2. 过 LAC  
3. 打标签  


# 皮卡专家观点提取 11.17    

## 方法 1 

1. 先从 es 取数据  
2. 用动词过滤  
3. 用正则过滤  
4. title 去重  


# 单句模型处理测试集 11.16  

## 方法 1   

`label_map = {1: "负面", 0: "正面"}`  

1. 怎么遍历多句
2. 怎么把句子送进模型
3. 怎么决定输出


## 方法 2 

1. 遍历多句 
2. 返回句子个数列表  
3. 跑模型，得到中间每个句子的结果
4. 根据结果分组，根据分组得到最后的结果


# 具体内容错例分析 11.11 

## 方法 1 

错例和句子个数的相关性  

1. 把正确的例子从验证集中分出来。已完成。  
2. 统计错例句子长度各自占比。 
3. 统计正确句子长度各自占比  
4. 比较结果  


# 错例分析 11.10   

## 方法 1 

1. predict 验证集  
2. 拿到 test_prediction.json  
3. 把 test_prediction 标签和验证集标签做对比，直接用 zip 就可以    
4. 不相等的拿出来  
5. 分析  



# ES 改 flag 脚本 11.09 

## 方法 1  

1. 先取数据
2. 拿到 flag 字段 
3. 做判断  
4. update 字段  


# 国家统计和国家文章列表缓存没有生效  11.04 

## 方法 1   

1. 看 Redis 里有没有缓存  
2. 看代码中是在哪里取的缓存  
3. 有没有取到缓存？为什么  

先确认国家统计是不是每次请求。已完成，是每次都重新请求。    

确认国家统计有没有生效。缓存没有生效。    

然后看文章列表。没有问题。    


# 训练 en v3 模型 11.03  

换数据执行命令应该就行了  

1. 先删除原来的模型。已完成。  
2. 换数据。已完成。    
3. 改标签。已完成。  
4. 训练新的模型。已完成。
5. 模型部署。已完成。  
6. 跑数据。已完成。    

改脚本，说清楚原来的问题，怎么改  

走通原来的代码  
说清楚原来的问题  
给出解决方案  


# 字幕和花字分离 11.01   

## 方法 4   

有两个问题：  
1. 字幕顺序被打乱了；先确定是不是乱了，对比视频和文字。已完成，确定顺序是乱的；乱了怎么排序；用 pandas 的 sort_values()    
2. 按照高度限制。1、高度是多少？2、限制写在哪里？3、怎么设置为空  


## 方法 3 

两条路  

1、读代码，理解思想 
2、再找别的项目  


## 方法 2   

先读 readme 文档。已完成。    

走通流程  

debug 5 遍代码  


## 方法 1  

### 问题  

识别的字不一样  
重复率取多少？文本长短，比如一共 10 句话，一句字幕就占了 10%。可能还要做判断。  
怎么根据位置判断。（每个视频字幕位置不一样）  


### 流程  

2. 定规则  
① 不管技术，定规则  
字幕相对固定，出现在特定区域，并且持续出现，内容变化度高  
花字重复率高，每帧识别结果重复度高  

② 考虑技术
先判断重复率，重复率非常高的是花字  
再判断位置，位置相对固定的，内容变化度高的是字幕  

7. 根据位置和变化率进行判断  


### 已完成  

1. 读聊天记录，读文档，读 CSV 文件，读脚本。完成   

2. 读取 CSV 文本。已完成。  

3. 统计数量。已完成。

4. 算重复率。已完成。  

5. 提取位置  
坐标含义：已完成。  


# 预测治理统计匹配的每一步都是多少数据 10.26  

## 方法 1  

先做预测，先做中文    


### 分析过程  

1. 姓名匹配以后剩多少？姓名匹配是在哪里做的。  
先看视图函数和 middleware，先看预测  
4. 正则怎么匹配  


# 技术预测和技术治理的提取 09.07   

先做技术治理。  

原来是在全文里找，现在要在一段里找。  

1、原来是怎么找的。  
2、这一段是怎么找的。  
3、把全文改成一段就可以了。  

有一个问题是，现在的技术预测里的 point_text 有些是全文。这个最后做。  



不是看预测和治理，而是看专家观点。  


技术治理原来显示的内容是怎么找的。  

原来是直接用的 zhili_text，在 es 里就是有 zhili_text。  

es 索引是 zhili-zky，有 zhili_text 这个字段，看这个字段是怎么上传到 es 中去的  

找不到。  



看一看预测原来显示的内容是怎么找的。  


08.23  

# 只显示 10 页，10 页以后的内容没有办法显示

问题产生的原因：最开始返回的总页数是，从 ES 里查的总数，但是使用缓存的时候就改成了单批缓存的数量。  

解决办法：使用缓存的时候，不要使用单批缓存的数量，而是使用总数量的缓存。  


# 判断是使用缓存，还是再次请求

最开始是想使用页数，想在缓存名前加页数，一直不成功，点击 15 页，没有文章显示，而且会报错，说是无效的请求。  

这个问题的核心是判断当前数量是在缓存范围内，还是缓存范围之外；如果是在缓存范围之内，就使用缓存，如果在缓存范围之外，就再次去 ES 里查询

解决办法：用数量做判断。如果在数量以内，就使用缓存，如果在数量以外，就再次取 ES 里查询。    



