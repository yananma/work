
# 字幕和花字分离 11.01   

## 方法 4   

有两个问题：  
1. 字幕顺序被打乱了；先确定是不是乱了，对比视频和文字。已完成，确定顺序是乱的；乱了怎么排序；用 pandas 的 sort_values()    
2. 按照高度限制。1、高度是多少？2、限制写在哪里？3、怎么设置为空  


## 方法 3 

两条路  

1、读代码，理解思想 
2、再找别的项目  


## 方法 2   

先读 readme 文档。已完成。    

走通流程  

debug 5 遍代码  


## 方法 1  

### 问题  

识别的字不一样  
重复率取多少？文本长短，比如一共 10 句话，一句字幕就占了 10%。可能还要做判断。  
怎么根据位置判断。（每个视频字幕位置不一样）  


### 流程  

2. 定规则  
① 不管技术，定规则  
字幕相对固定，出现在特定区域，并且持续出现，内容变化度高  
花字重复率高，每帧识别结果重复度高  


② 考虑技术
先判断重复率，重复率非常高的是花字  
再判断位置，位置相对固定的，内容变化度高的是字幕  


7. 根据位置和变化率进行判断  


### 已完成  

1. 读聊天记录，读文档，读 CSV 文件，读脚本。完成   


3. 读取 CSV 文本。已完成。  


4. 统计数量。已完成。


5. 算重复率。已完成。  


6. 提取位置  
坐标含义：已完成。  




#### 预测治理统计匹配的每一步都是多少数据 10.26  

## 方法 1  

先做预测，先做中文    


### 分析过程  

1. 姓名匹配以后剩多少？姓名匹配是在哪里做的。  
先看视图函数和 middleware，先看预测  
4. 正则怎么匹配  


### 已解决  

中文预测  
1. 处理之前：22811145 条  
2. 匹配完动词：7353923 条   
3. 匹配完标志词：736329 条  
4. 过完模型：18140 条  
5. 姓名匹配：10706 条  


中文治理  
1. 处理之前：22811145 条   
2. 匹配完动词：7353923 条   
3. 匹配完标志词：    
4. 过完模型：193758 条   
5. 姓名匹配：128718 条  


英文预测  
1. 处理之前：194309 条   
2. 匹配完标志词：26387 条  
3. 过完模型：2483 条  


英文治理  
1. 处理之前：194309 条  
2. 匹配完标志词：84333 条  
3. 过完模型：18226 条   


09.07 

#### 技术预测和技术治理的提取（未完成）  

先做技术治理。  

原来是在全文里找，现在要在一段里找。  

1、原来是怎么找的。  
2、这一段是怎么找的。  
3、把全文改成一段就可以了。  

有一个问题是，现在的技术预测里的 point_text 有些是全文。这个最后做。  



不是看预测和治理，而是看专家观点。  


技术治理原来显示的内容是怎么找的。  

原来是直接用的 zhili_text，在 es 里就是有 zhili_text。  

es 索引是 zhili-zky，有 zhili_text 这个字段，看这个字段是怎么上传到 es 中去的  

找不到。  



看一看预测原来显示的内容是怎么找的。  


08.23  

#### 只显示 10 页，10 页以后的内容没有办法显示

问题产生的原因：最开始返回的总页数是，从 ES 里查的总数，但是使用缓存的时候就改成了单批缓存的数量。  

解决办法：使用缓存的时候，不要使用单批缓存的数量，而是使用总数量的缓存。  


#### 判断是使用缓存，还是再次请求

最开始是想使用页数，想在缓存名前加页数，一直不成功，点击 15 页，没有文章显示，而且会报错，说是无效的请求。  

这个问题的核心是判断当前数量是在缓存范围内，还是缓存范围之外；如果是在缓存范围之内，就使用缓存，如果在缓存范围之外，就再次去 ES 里查询

解决办法：用数量做判断。如果在数量以内，就使用缓存，如果在数量以外，就再次取 ES 里查询。    



