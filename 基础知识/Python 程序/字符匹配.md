
07.29  

```python 
class MyRequest:
    def __init__(self, query_param, data_param):
        self.query_param = query_param
        self.data_param = data_param


request1 = MyRequest(
    query_param={
        'ts': '114514',
        'name': 'syb'
    },
    data_param={
        'password': '1234567'
    }
)


import functools


def arg_wrap(arg_name, must_in_place=None, arg_type=None, arg_validate=None):
    def outer(func):
        @functools.wraps(func)
        def inner(request,*args, **kwargs):
            if must_in_place is None:
                arg_value = request.query_param.get(arg_name, None) or request.data_param.get(arg_name, None)
            elif must_in_place in ['query_param','data_param']:
                arg_value = getattr(request,must_in_place,None)
            # elif must_in_place == 'query_param':
            #     arg_value = request.query_param.get(arg_name, None)
            # elif must_in_place == 'data_param':
            #     arg_value = request.data_param.get(arg_name, None)

            if arg_type is not None:
                arg_value = arg_type(arg_value)

            if arg_validate is not None:
                result = arg_validate(arg_value)
                if result is False:
                    raise Exception

            if getattr(request, 'ARGS', None) is None:
                request.ARGS = {arg_name: arg_value}
            else:
                request.ARGS[arg_name]= arg_value

            # print(getattr(request, 'query_param'))
            res = func(request, *args, **kwargs)
            return res
        return inner
    return outer


@arg_wrap('name', must_in_place='query_param')
@arg_wrap('ts', arg_type=int)
@arg_wrap('password', arg_validate=lambda x:len(x)>6)
def my_func(request):
    print('success in view func')
    print(request.query_param)
    print(request.data_param)
    print(request.ARGS)
    print('***********')


my_func(request1)
```



07.28  
```python
# add_tag函数会替换成 "\t这是一个字符串，有<TAG country='中国'>中科院</TAG>这个单词   "
# normalize会去除上一步空格、标点符号等变成 "这是一个字符串TAGcountry中国中科院TAG这个单词"
# s = TextTools('\t这是一个字符串，有中科院这个单词   ').add_tag(source='中科院' ,target='中国').normalize()
# print(s) # 打印 "这是一个字符串TAGcountry中国中科院TAG这个单词"

from collections import UserString
import re


class TextTools(UserString):

    def __init__(self, s):
        self.data = s

    def add_tag(self, source, target):
        self.data = re.sub(source, "<TAG country='{}'>{}</TAG>".format(target, source), self.data)
        return self

    def normalize(self):
        self.data = re.sub(r'[<>=\'\'/ ，]', '', self.data).strip()
        return self


print(TextTools('\t这是一个字符串，有中科院这个单词   ').add_tag(source='中科院', target='中国').normalize())
```


改进方法  

```python         
def add_tag(self, source, target):
    self.data = re.sub(f'({source})', r"<TAG country='{}'>\1</TAG>".format(target), self.data)
    return self

# f'({source})' 和下面的内容是等价的  
# s = '({})'.format(source)

```
